{% extends "base.html" %}

{% block title %}{{ produto.nome }} | {{ config.get('titulo_site', 'Loja Oficial') }}{% endblock %}

{% block content %}
<style>
    .product-detail-wrapper { 
        display: flex; 
        flex-wrap: wrap; 
        gap: 40px; 
        margin: 30px auto; 
        max-width: 1200px; 
        padding: 20px; 
        background: #fff; 
        border-radius: 12px; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
    }
    .media-gallery { flex: 1.2; min-width: 300px; }
    .main-image { 
        width: 100%; 
        border-radius: 10px; 
        overflow: hidden; 
        border: 1px solid #f0f0f0; 
        background: #f9f9f9; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        min-height: 400px; 
    }
    .main-image img { max-width: 100%; max-height: 500px; object-fit: contain; transition: 0.3s; }
    
    .thumbnails { 
        display: flex; 
        gap: 12px; 
        margin-top: 15px; 
        overflow-x: auto; 
        padding-bottom: 10px; 
    }
    .thumbnails img { 
        width: 80px; 
        height: 80px; 
        object-fit: cover; 
        border-radius: 6px; 
        cursor: pointer; 
        border: 2px solid #eee; 
        transition: 0.2s;
    }
    .thumbnails img:hover { border-color: #28a745; }
    
    .info-side { flex: 1; min-width: 300px; }
    .product-price { font-size: 2.5rem; font-weight: 800; color: #28a745; margin: 0; }
    
    .btn-compra { 
        display: block; 
        background: #28a745; 
        color: #fff; 
        text-align: center; 
        padding: 18px; 
        font-size: 1.4rem; 
        font-weight: bold; 
        text-decoration: none; 
        border-radius: 8px; 
        text-transform: uppercase; 
        transition: 0.3s; 
    }
    .btn-compra:hover { background: #218838; transform: translateY(-2px); }
    
    .video-container { 
        width: 100%; 
        margin-top: 40px; 
        text-align: center; 
        border-top: 1px solid #eee; 
        padding-top: 30px; 
    }
    .video-container video { max-width: 100%; width: 800px; border-radius: 12px; background: #000; }

    @media (max-width: 768px) {
        .product-detail-wrapper { flex-direction: column; gap: 20px; }
        .main-image { min-height: 300px; }
    }
</style>

<div class="container">
    <div class="product-detail-wrapper">
        <div class="media-gallery">
            <div class="main-image">
                {% if imagens and imagens[0] %}
                    {% set img_url = imagens[0] if imagens[0].startswith('http') else url_for('static', filename='uploads/' + imagens[0].split('/')[-1]) %}
                    <img id="current-image" src="{{ img_url }}" alt="{{ produto.nome }}">
                {% else %}
                    <img id="current-image" src="{{ url_for('static', filename='default-product.jpg') }}">
                {% endif %}
            </div>
            
            <div class="thumbnails">
                {% for img_path in imagens %}
                    {% if img_path %}
                        {% set src_path = img_path if img_path.startswith('http') else url_for('static', filename='uploads/' + img_path.split('/')[-1]) %}
                        <img src="{{ src_path }}" onclick="changeMainImage('{{ src_path }}')" alt="Miniatura">
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <div class="info-side">
            <h1 style="margin-top: 0; color: #333;">{{ produto.nome }}</h1>
            
            <div class="price-container" style="padding: 20px; background: #fcfcfc; border-radius: 10px; border-left: 5px solid #28a745; margin-bottom: 25px;">
                {% if produto.em_oferta %}
                    <small style="text-decoration: line-through; color: #999;">R$ {{ "%.2f"|format(produto.preco)|replace('.', ',') }}</small>
                    <p class="product-price">R$ {{ "%.2f"|format(produto.novo_preco)|replace('.', ',') }}</p>
                {% else %}
                    <p class="product-price">R$ {{ "%.2f"|format(produto.preco)|replace('.', ',') }}</p>
                {% endif %}
                <small style="color: #666;"><i class="fa fa-lock"></i> Pagamento seguro via Mercado Pago</small>
            </div>

            <div class="description-full" style="margin-bottom: 30px; color: #555; line-height: 1.6;">
                <strong style="display: block; margin-bottom: 10px;">ðŸ“‹ DescriÃ§Ã£o do Produto:</strong>
                <div style="white-space: pre-line;">{{ (produto.descricao or "Sem descriÃ§Ã£o disponÃ­vel.")|safe }}</div>
            </div>

            <a href="{{ url_for('checkout', id_produto=produto.id) }}" class="btn-compra">
                <i class="fa fa-shopping-cart"></i> Comprar Agora
            </a>
        </div>

        {% if produto.video_path %}
        <div class="video-container">
            <h2 style="font-size: 1.5rem; color: #333; margin-bottom: 20px;">ðŸŽ¥ VÃ­deo Demonstrativo</h2>
            {% set video_filename = produto.video_path.split('/')[-1] %}
            <video controls preload="metadata">
                <source src="{{ url_for('static', filename='uploads/' + video_filename) }}" type="video/mp4">
                Seu navegador nÃ£o suporta vÃ­deos.
            </video>
        </div>
        {% endif %}
    </div>
</div>

<script>
    function changeMainImage(src) {
        const mainImg = document.getElementById('current-image');
        // Adiciona um efeito suave de troca
        mainImg.style.opacity = '0';
        setTimeout(() => {
            mainImg.src = src;
            mainImg.style.opacity = '1';
        }, 200);
    }
</script>
{% endblock %}
