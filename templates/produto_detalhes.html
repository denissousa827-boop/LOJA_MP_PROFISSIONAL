{% extends "base.html" %}

{% block title %}{{ produto.nome }} | Minha Loja Oficial{% endblock %}

{% block content %}
    <div class="product-detail-container">

        <div class="media-gallery">
            <div class="main-image">
                {% if imagens[0] %}
                    {% set filename = imagens[0].split('/')[-1] %}
                    <img id="current-image" src="{{ url_for('static', filename='uploads/' + filename) }}" alt="{{ produto.nome }} - Imagem Principal">
                {% else %}
                    <img id="current-image" src="{{ url_for('static', filename='placeholder.png') }}" alt="Imagem não disponível">
                {% endif %}
            </div>
            <div class="thumbnails">
                {% for img_path in imagens %}
                    {% if img_path %}
                        {% set filename = img_path.split('/')[-1] %}
                        {% set src_path = url_for('static', filename='uploads/' + filename) %}
                        <img src="{{ src_path }}" alt="{{ produto.nome }} - Miniatura {{ loop.index }}" onclick="changeMainImage('{{ src_path }}')">
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <div class="info-side">
            <h1>{{ produto.nome }}</h1>
            
            <p class="product-price">R$ {{ "%.2f"|format(produto.preco)|replace('.', ',') }}</p>

            <p class="description-full">
                <strong>Descrição Completa:</strong>
                <br>
                {{ produto.descricao or "Descrição completa não disponível." }}
            </p>

            <a href="{{ url_for('comprar_produto', id_produto=produto.id) }}" class="btn-compra btn-detail">
                Comprar Agora
            </a>

            </div>

        {% if produto.video_path %}
        <div class="video-container">
            <h2>Vídeo de Apresentação</h2>
            {% set video_filename = produto.video_path.split('/')[-1] %}
            <video controls>
                <source src="{{ url_for('static', filename='uploads/' + video_filename) }}" type="video/mp4">
                Seu navegador não suporta a tag de vídeo.
            </video>
        </div>
        {% endif %}

    </div>

    <script>
        // Função para trocar a imagem principal
        function changeMainImage(src) {
            document.getElementById('current-image').src = src;
        }
    </script>
{% endblock %}
